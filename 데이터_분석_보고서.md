# 림프칩 PINN 프로젝트 - 데이터 분석 보고서

> 작성일: 2026-01-26
> 버전: v2 (kdecay 통합)

---

## 목차

1. [데이터 개요](#1-데이터-개요)
2. [데이터 소스 상세](#2-데이터-소스-상세)
3. [파라미터 분석](#3-파라미터-분석)
4. [시계열 데이터 구조](#4-시계열-데이터-구조)
5. [데이터 통계](#5-데이터-통계)
6. [데이터 전처리 파이프라인](#6-데이터-전처리-파이프라인)
7. [데이터 품질 이슈](#7-데이터-품질-이슈)

---

## 1. 데이터 개요

### 1.1 프로젝트 목적

이 프로젝트는 **림프칩(Lymph-on-Chip)** 시뮬레이션 결과를 예측하는 대리 모델을 구축합니다.

- **입력**: 6개의 물리적 파라미터
- **출력**: 72시간 동안의 약물 분포 (Blood, Lymph, ECM, Decay)

### 1.2 데이터 출처

| 파일명 | 설명 | 케이스 수 |
|--------|------|-----------|
| `251103 (revised)_Injection site results v2 (수정).xlsx` | 파라미터 변화에 따른 시뮬레이션 | 12개 Case |
| `251103 (revised)_sol765.xlsx` | kdecay 변화에 따른 Decay 시뮬레이션 | 12개 시트 |

### 1.3 데이터 규모

```
총 케이스: 24개
├── Injection site: 12개 (kdecay = 0)
└── sol765: 12개 (다양한 kdecay)

시간 포인트: 각 케이스당 약 100-200개
시간 범위: 0 ~ 72시간
출력 변수: 4개 (Blood, Lymph, ECM, Decay)
```

---

## 2. 데이터 소스 상세

### 2.1 Injection Site Results (주요 데이터)

#### 케이스 목록

| Case | 변경 파라미터 | 설명 |
|------|--------------|------|
| Case1 | - | Representative (기준값) |
| Case2-1 | Lp_ve = Low | 낮은 혈관 투과도 |
| Case2-2 | Lp_ve = High | 높은 혈관 투과도 |
| Case3-1 | K = Low | 낮은 수력 전도도 |
| Case3-2 | K = High | 높은 수력 전도도 |
| Case4-1 | P_oncotic = Low | 낮은 삼투압 |
| Case4-2 | P_oncotic = High | 높은 삼투압 |
| Case5-1 | sigma_ve = Low | 낮은 반사 계수 |
| Case5-2 | sigma_ve = High | 높은 반사 계수 |
| Case6-1 | D_gel = Low | 낮은 확산 계수 |
| Case6-2 | D_gel = High | 높은 확산 계수 |
| Case7 | - | 추가 케이스 |

#### Excel 컬럼 구조

```
Column 14: Time (h)          - 시간 (0~72시간)
Column 15: Total Mass (%)    - 총 질량 (미사용)
Column 16: Lymph (%)         - 림프 구획 비율
Column 17: Blood (%)         - 혈액 구획 비율
Column 18: Decay (%)         - 분해된 비율
Column 19: ECM (%)           - 세포외기질 비율
```

#### 파라미터 추출 위치

헤더 행(Row 0)에서 정규표현식으로 추출:
```
패턴: (\w+)=([0-9.E+-]+)
예시: "Lp_ve=8E-12, K=1E-15, ..."
```

### 2.2 sol765 (Decay 데이터)

#### 시트 목록

| 시트명 | 약물 종류 | kdecay 값 |
|--------|----------|-----------|
| IgG kdecay 0 | IgG (150 kDa) | 0 |
| IgG kdecay 2.9e-7 | IgG | 2.9×10⁻⁷ |
| IgG kdecay 1.7e-6 | IgG | 1.7×10⁻⁶ |
| IgG kdecay 1.5e-5 | IgG | 1.5×10⁻⁵ |
| INS kdecay 0 | INS (5.8 kDa) | 0 |
| INS kdecay 2.9e-7 | INS | 2.9×10⁻⁷ |
| INS kdecay 1.7e-6 | INS | 1.7×10⁻⁶ |
| INS kdecay 1.5e-5 | INS | 1.5×10⁻⁵ |
| ALB kdecay 0 | ALB (66.5 kDa) | 0 |
| ALB kdecay 2.9e-7 | ALB | 2.9×10⁻⁷ |
| ALB kdecay 1.7e-6 | ALB | 1.7×10⁻⁶ |
| ALB kdecay 1.5e-5 | ALB | 1.5×10⁻⁵ |

#### 약물 특성

| 약물 | 분자량 (kDa) | 특성 |
|------|-------------|------|
| IgG | 150 | 면역글로불린 G (항체) |
| INS | 5.8 | 인슐린 (소분자) |
| ALB | 66.5 | 알부민 (혈장 단백질) |

---

## 3. 파라미터 분석

### 3.1 입력 파라미터 정의

| 파라미터 | 기호 | 단위 | 물리적 의미 |
|----------|------|------|-------------|
| Lp_ve | Lp | m/(Pa·s) | 혈관벽의 수력 투과도 |
| K | K | m² | ECM의 수력 전도도 |
| P_oncotic | Pπ | Pa | 혈장 삼투압 |
| sigma_ve | σ | - | 용질의 막 투과 반사 계수 |
| D_gel | D | m²/s | ECM 내 약물 확산 계수 |
| kdecay | k | 1/s | 약물 분해 속도 상수 |

### 3.2 파라미터 범위

```
┌────────────┬─────────────────┬─────────────────┬─────────────────┐
│ 파라미터    │      Low        │      Mid        │      High       │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Lp_ve      │ 4.0 × 10⁻¹²    │ 8.0 × 10⁻¹²    │ 1.6 × 10⁻¹¹    │
│ K          │ 1.0 × 10⁻¹⁷    │ 1.0 × 10⁻¹⁵    │ 1.0 × 10⁻¹³    │
│ P_oncotic  │ 3,145           │ 3,590           │ 3,815           │
│ sigma_ve   │ 0.1             │ 0.5             │ 0.9             │
│ D_gel      │ 1.0 × 10⁻¹¹    │ 3.0 × 10⁻¹¹    │ 1.0 × 10⁻¹⁰    │
│ kdecay     │ 0               │ 1.7 × 10⁻⁶     │ 1.5 × 10⁻⁵     │
└────────────┴─────────────────┴─────────────────┴─────────────────┘
```

### 3.3 파라미터 정규화

#### 로그 스케일 (Lp_ve, K, D_gel)

```python
# Mid 이하
normalized = (log10(value) - log10(mid)) / (log10(mid) - log10(low))

# Mid 이상
normalized = (log10(value) - log10(mid)) / (log10(high) - log10(mid))
```

**예시: Lp_ve = 4e-12 (Low)**
```
log10(4e-12) = -11.40
log10(8e-12) = -11.10  (mid)
log10(4e-12) = -11.40  (low)

normalized = (-11.40 - (-11.10)) / (-11.10 - (-11.40))
           = -0.30 / 0.30
           = -1.0 ✓
```

#### 선형 스케일 (P_oncotic, sigma_ve)

```python
# Mid 이하
normalized = (value - mid) / (mid - low)

# Mid 이상
normalized = (value - mid) / (high - mid)
```

#### 로그-제로 스케일 (kdecay)

```python
if value <= 0:
    normalized = -1.0  # 0은 항상 -1
elif value <= mid:
    normalized = -1.0 + (value / mid)  # 선형 보간
else:
    # 로그 스케일
    normalized = (log10(value) - log10(mid)) / (log10(high) - log10(mid))
```

### 3.4 파라미터-결과 상관관계

| 파라미터 증가 | Blood 영향 | Lymph 영향 | ECM 영향 | 물리적 설명 |
|--------------|-----------|-----------|---------|------------|
| Lp_ve ↑ | - | ↑↑ | ↓ | 혈관 투과도 증가 → 림프 이동 증가 |
| K ↑ | ↑ | ↑ | ↓ | 전체 유체 이동 증가 |
| P_oncotic ↑ | - | ↓ | ↑ | 삼투압 증가 → 림프 흡수 감소 |
| sigma_ve ↑ | ↓ | ↓ | ↑ | 막 투과 감소 |
| D_gel ↑ | ↑ | ↑ | ↓ | 확산 증가 → 평형 빠르게 도달 |
| kdecay ↑ | ↓ | ↓ | ↓ | 약물 분해 → Decay ↑ |

---

## 4. 시계열 데이터 구조

### 4.1 출력 변수

| 변수 | 설명 | 범위 | 초기값 | 최종값 (예시) |
|------|------|------|--------|--------------|
| Blood | 혈액 구획 내 약물 비율 | 0-100% | ~0% | 10-30% |
| Lymph | 림프 구획 내 약물 비율 | 0-100% | ~0% | 30-70% |
| ECM | 세포외기질 내 약물 비율 | 0-100% | ~100% | 10-40% |
| Decay | 분해된 약물 비율 | 0-100% | 0% | 0-50% |

### 4.2 시간 프로파일 특성

```
100% ─┬─────────────────────────────────────────────────────
      │ ECM ╲
      │      ╲
 75%  │       ╲
      │        ╲
      │         ╲────────────────────────────
 50%  │          ╲                   Lymph
      │           ╲            ╱────────────
      │            ╲     ╱───╱
 25%  │             ╲───╱         Blood
      │                    ╱────────────────
      │              ╱───╱
  0%  ┴───╱──────────────────────────────────────────────────
      0h      12h      24h      36h      48h      60h      72h
```

#### 전형적인 곡선 특성

1. **ECM**: 지수적 감소 (초기 100% → 최종 10-40%)
2. **Lymph**: S자 곡선 증가 (초기 0% → 최종 30-70%)
3. **Blood**: 느린 증가 (초기 0% → 최종 10-30%)
4. **Decay**: kdecay에 따라 0% 또는 점진적 증가

### 4.3 시간 해상도

```
시간 범위: 0 ~ 72 시간
데이터 포인트: 약 100-200개 / 케이스
평균 간격: 0.36 ~ 0.72 시간 (약 22-43분)
```

---

## 5. 데이터 통계

### 5.1 Injection Site 케이스별 72시간 최종값

| Case | Blood (%) | Lymph (%) | ECM (%) | Decay (%) |
|------|-----------|-----------|---------|-----------|
| Case1 (Representative) | 18.4 | 47.9 | 33.7 | 0.0 |
| Case2-1 (Low Lp) | 8.2 | 69.3 | 22.5 | 0.0 |
| Case2-2 (High Lp) | 51.9 | 30.4 | 17.7 | 0.0 |
| Case3-1 (Low K) | 26.7 | 29.4 | 43.9 | 0.0 |
| Case3-2 (High K) | 23.1 | 38.1 | 38.8 | 0.0 |
| Case4-1 (Low Oncotic) | 23.3 | 37.7 | 39.0 | 0.0 |
| Case4-2 (High Oncotic) | 18.4 | 48.2 | 33.4 | 0.0 |
| Case5-1 (Low Sigma) | 12.6 | 51.4 | 36.0 | 0.0 |
| Case5-2 (High Sigma) | 24.0 | 44.9 | 31.1 | 0.0 |
| Case6-1 (Low D) | 18.1 | 47.5 | 34.4 | 0.0 |
| Case6-2 (High D) | 18.6 | 48.3 | 33.1 | 0.0 |

### 5.2 sol765 kdecay별 72시간 Decay 비율

| 약물 | kdecay = 0 | kdecay = 2.9e-7 | kdecay = 1.7e-6 | kdecay = 1.5e-5 |
|------|-----------|-----------------|-----------------|-----------------|
| IgG | 0% | ~7% | ~30% | ~49% |
| INS | 0% | ~7% | ~30% | ~49% |
| ALB | 0% | ~7% | ~30% | ~49% |

### 5.3 전체 통계 요약

```
Blood 비율:
  - 최소: 8.2%  (Case2-1, Low Lp)
  - 최대: 51.9% (Case2-2, High Lp)
  - 평균: 22.1%
  - 표준편차: 11.3%

Lymph 비율:
  - 최소: 29.4% (Case3-1, Low K)
  - 최대: 69.3% (Case2-1, Low Lp)
  - 평균: 44.1%
  - 표준편차: 11.2%

ECM 비율:
  - 최소: 17.7% (Case2-2, High Lp)
  - 최대: 43.9% (Case3-1, Low K)
  - 평균: 33.0%
  - 표준편차: 7.8%

Decay 비율 (sol765, kdecay=1.5e-5):
  - 최대: ~49%
```

---

## 6. 데이터 전처리 파이프라인

### 6.1 전체 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│                     Excel 파일 로드                              │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    시트 이름 파싱                                │
│  - "Case" 포함 여부 확인                                        │
│  - 약물 종류 (IgG/INS/ALB) 추출                                 │
│  - kdecay 값 추출                                               │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   파라미터 추출                                  │
│  - 헤더 행에서 정규표현식 매칭                                   │
│  - 패턴: (\w+)=([0-9.E+-]+)                                     │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                  시계열 데이터 추출                              │
│  - Column 14: Time (h)                                          │
│  - Column 16: Lymph (%)                                         │
│  - Column 17: Blood (%)                                         │
│  - Column 18: Decay (%)                                         │
│  - Column 19: ECM (%)                                           │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   데이터 정제                                    │
│  - 시간 역행 감지 시 중단 (다른 데이터셋 시작)                   │
│  - 72시간 초과 데이터 제외                                       │
│  - NaN 값 처리                                                   │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                  파라미터 정규화                                 │
│  - 실제값 → [-1, +1] 범위 변환                                  │
│  - 스케일별 처리 (log, linear, log_zero)                        │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   유효성 검사                                    │
│  - 총 비율 합계 > 90% 확인                                      │
│  - 데이터 포인트 수 확인                                        │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   최종 데이터 구조                               │
│  {                                                              │
│    'case_name': {                                               │
│      'params': {Lp_ve: 8e-12, K: 1e-15, ...},                  │
│      'params_normalized': np.array([0, 0, 0, 0, 0, -1]),       │
│      'time_series': DataFrame(time_hour, Blood, Lymph, ...)    │
│    },                                                           │
│    ...                                                          │
│  }                                                              │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 시간 데이터 처리 로직

```python
# 시간 역행 감지 (다른 데이터셋 시작 지점)
if time_hour < prev_time - 0.1:
    break  # 현재 케이스 데이터 종료

# 72시간 초과 제외
if time_hour > 72:
    break

# 72시간 도달 시 종료
if time_hour >= 71.9:
    break
```

### 6.3 보간기 데이터 로드

```python
def create_interpolator_from_data():
    preprocessor = TimeSeriesPreprocessor(data_dir)

    # 1. Injection site 데이터 (12개, kdecay=0)
    case_data = preprocessor.load_case_data()

    # 2. sol765 Decay 데이터 (12개, 다양한 kdecay)
    decay_data = preprocessor.load_decay_data()

    # 3. 보간기에 모든 케이스 추가
    interpolator = CaseInterpolator()

    for case_name, data in case_data.items():
        interpolator.add_case(
            case_name=case_name,
            params_normalized=data['params_normalized'],
            time_series=data['time_series']
        )

    for case_name, data in decay_data.items():
        interpolator.add_case(
            case_name=f"sol765_{case_name}",
            params_normalized=data['params_normalized'],
            time_series=data['time_series']
        )

    return interpolator
```

---

## 7. 데이터 품질 이슈

### 7.1 발견된 이슈

#### Issue 1: 중복 데이터셋

일부 Excel 시트에 여러 데이터셋이 포함되어 있었음.

**해결책**: 시간이 역행하는 지점을 감지하여 첫 번째 데이터셋만 사용

```python
if time_hour < prev_time - 0.1:  # 시간이 감소하면
    break  # 다른 데이터셋 시작 → 중단
```

#### Issue 2: Injection Site의 Decay = 0

Injection site 데이터의 모든 케이스에서 Decay = 0%

**원인**: 시뮬레이션에서 kdecay = 0으로 설정됨

**해결책**: sol765 데이터를 통합하여 kdecay를 추가 파라미터로 포함

#### Issue 3: 파라미터 범위 불일치

일부 케이스의 파라미터가 정의된 범위를 벗어남

**해결책**: 정규화 시 -1 ~ +1 범위로 클리핑

```python
return max(-1, min(1, normalized))
```

### 7.2 데이터 한계

1. **케이스 수 제한**: 24개 케이스로 파라미터 공간 전체를 커버하기 어려움
2. **단일 파라미터 변화**: 대부분의 케이스가 한 번에 하나의 파라미터만 변경
3. **상호작용 효과 부재**: 파라미터 간 상호작용 데이터 없음
4. **약물 종류 고정**: IgG 기준 시뮬레이션 (sol765 제외)

### 7.3 개선 권장사항

1. **추가 시뮬레이션**:
   - 여러 파라미터를 동시에 변경하는 케이스 추가
   - Latin Hypercube Sampling으로 파라미터 공간 균등 샘플링

2. **데이터 증강**:
   - 기존 케이스 간 보간으로 가상 케이스 생성
   - 노이즈 추가를 통한 데이터 증강

3. **불확실성 정량화**:
   - 각 예측에 대한 신뢰 구간 제공
   - 보간 거리에 따른 예측 신뢰도 표시

---

## 부록: 데이터 파일 상세

### A. Excel 파일 구조

```
251103 (revised)_Injection site results v2 (수정).xlsx
├── Summary          (요약 데이터)
├── Case1            (Representative)
├── Case2-1          (Low Lp)
├── Case2-2          (High Lp)
├── Case3-1          (Low K)
├── Case3-2          (High K)
├── Case4-1          (Low Oncotic)
├── Case4-2          (High Oncotic)
├── Case5-1          (Low Sigma)
├── Case5-2          (High Sigma)
├── Case6-1          (Low D)
└── Case6-2          (High D)

251103 (revised)_sol765.xlsx
├── IgG kdecay 0
├── IgG kdecay 2.9e-7
├── IgG kdecay 1.7e-6
├── IgG kdecay 1.5e-5
├── INS kdecay 0
├── INS kdecay 2.9e-7
├── INS kdecay 1.7e-6
├── INS kdecay 1.5e-5
├── ALB kdecay 0
├── ALB kdecay 2.9e-7
├── ALB kdecay 1.7e-6
└── ALB kdecay 1.5e-5
```

### B. 데이터 타입

| 필드 | 타입 | 예시 |
|------|------|------|
| time_hour | float64 | 36.0 |
| Blood | float64 | 18.4 |
| Lymph | float64 | 47.9 |
| ECM | float64 | 33.7 |
| Decay | float64 | 0.0 |
| params_normalized | ndarray (6,) | [0, 0, 0, 0, 0, -1] |

---

*문서 끝*
